1Ô∏è‚É£ BUAT PROJECT
composer create-project laravel/laravel perpus-cots
cd perpus-cots
php artisan key:generate

2Ô∏è‚É£ KONFIGURASI .env
DB_DATABASE=perpus_cots
DB_USERNAME=root
DB_PASSWORD=

3Ô∏è‚É£ MIGRATION USER (TAMBAH ROLE)

Edit database/migrations/xxxx_create_users_table.php

$table->string('role')->default('user');

php artisan migrate

4Ô∏è‚É£ MIGRATION BOOK
php artisan make:model Book -m


database/migrations/xxxx_create_books_table.php

Schema::create('books', function (Blueprint $table) {
    $table->id();
    $table->string('title');
    $table->text('description');
    $table->date('release_date');
    $table->integer('rating');
    $table->timestamps();
});

php artisan migrate

5Ô∏è‚É£ MODEL

app/Models/Book.php

protected $fillable = ['title','description','release_date','rating'];

6Ô∏è‚É£ CONTROLLER AUTH
php artisan make:controller AuthController


app/Http/Controllers/AuthController.php

use App\Models\User;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;

public function login() {
    return view('login');
}

public function register() {
    return view('register');
}

public function loginProcess(Request $r) {
    if(Auth::attempt($r->only('email','password'))) {
        return redirect('/');
    }
    return back();
}

public function registerProcess(Request $r) {
    User::create([
        'name'=>$r->name,
        'email'=>$r->email,
        'password'=>Hash::make($r->password),
        'role'=>$r->role
    ]);
    return redirect('/login');
}

public function logout() {
    Auth::logout();
    return redirect('/login');
}

7Ô∏è‚É£ CONTROLLER BOOK
php artisan make:controller BookController


app/Http/Controllers/BookController.php

use App\Models\Book;

public function index() {
    $books = Book::all();
    return view('home',compact('books'));
}

public function store(Request $r) {
    Book::create($r->all());
    return back();
}

public function update(Request $r,$id) {
    Book::find($id)->update($r->all());
    return back();
}

public function destroy($id) {
    Book::find($id)->delete();
    return back();
}

8Ô∏è‚É£ MIDDLEWARE ADMIN
php artisan make:middleware AdminMiddleware


app/Http/Middleware/AdminMiddleware.php

if(auth()->user()->role!='admin'){
    abort(403);
}
return $next($request);


Register bootstrap/app.php

'admin' => \App\Http\Middleware\AdminMiddleware::class,

9Ô∏è‚É£ ROUTES

routes/web.php

use App\Http\Controllers\AuthController;
use App\Http\Controllers\BookController;

Route::get('/login',[AuthController::class,'login']);
Route::post('/login',[AuthController::class,'loginProcess']);
Route::get('/register',[AuthController::class,'register']);
Route::post('/register',[AuthController::class,'registerProcess']);
Route::get('/logout',[AuthController::class,'logout']);

Route::get('/',[BookController::class,'index'])->middleware('auth');
Route::post('/book',[BookController::class,'store'])->middleware(['auth','admin']);
Route::post('/book/{id}',[BookController::class,'update'])->middleware(['auth','admin']);
Route::get('/book/delete/{id}',[BookController::class,'destroy'])->middleware(['auth','admin']);

1Ô∏è‚É£ LAYOUT UTAMA (Bootstrap)
resources/views/layout.blade.php
<!DOCTYPE html>
<html>
<head>
<title>Perpustakaan Tertutup</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-light bg-white shadow-sm px-4">
<span class="navbar-brand fw-bold">Perpustakaan Tertutup</span>
<div>
<span class="badge bg-danger">{{ auth()->user()->role }}</span>
<a href="/logout" class="btn btn-outline-secondary btn-sm ms-2">Logout</a>
</div>
</nav>

<div class="container mt-4">
@yield('content')
</div>

</body>
</html>

üîü VIEW LOGIN

resources/views/login.blade.php

<!DOCTYPE html>
<html>
<head>
<title>Login</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light d-flex justify-content-center align-items-center vh-100">

<div class="card shadow" style="width:380px">
<div class="card-header bg-primary text-white text-center">Login</div>
<div class="card-body">
<form method="post" action="/login">
@csrf
<div class="mb-3">
<label>Email</label>
<input name="email" class="form-control">
</div>
<div class="mb-3">
<label>Password</label>
<input type="password" name="password" class="form-control">
</div>
<button class="btn btn-primary w-100">Login</button>
<div class="text-center mt-2">
<a href="/register">Register</a>
</div>
</form>
</div>
</div>

</body>
</html>

1Ô∏è‚É£1Ô∏è‚É£ VIEW REGISTER
<!DOCTYPE html>
<html>
<head>
<title>Register</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light d-flex justify-content-center align-items-center vh-100">

<div class="card shadow" style="width:420px">
<div class="card-header bg-success text-white text-center">Register</div>
<div class="card-body">
<form method="post" action="/register">
@csrf
<div class="mb-2">
<label>Name</label>
<input name="name" class="form-control">
</div>
<div class="mb-2">
<label>Email</label>
<input name="email" class="form-control">
</div>
<div class="mb-2">
<label>Password</label>
<input type="password" name="password" class="form-control">
</div>
<div class="mb-3">
<label>Role</label>
<select name="role" class="form-select">
<option value="user">Normal User</option>
<option value="admin">Admin</option>
</select>
</div>
<button class="btn btn-success w-100">Register</button>
<div class="text-center mt-2">
<a href="/login">Login</a>
</div>
</form>
</div>
</div>

</body>
</html>


1Ô∏è‚É£2Ô∏è‚É£ VIEW HOME

resources/views/home.blade.php

@extends('layout')

@section('content')

@if(auth()->user()->role=='admin')
<div class="alert alert-success">Book created successfully</div>

<div class="card mb-4">
<div class="card-header bg-primary text-white">Add New Book</div>
<div class="card-body">
<form method="post" action="/book" class="row g-2">
@csrf
<div class="col-md-3">
<input name="title" class="form-control" placeholder="Title">
</div>
<div class="col-md-3">
<input name="description" class="form-control" placeholder="Description">
</div>
<div class="col-md-2">
<input type="date" name="release_date" class="form-control">
</div>
<div class="col-md-2">
<input name="rating" class="form-control" placeholder="Rating">
</div>
<div class="col-md-2">
<button class="btn btn-primary w-100">Add Book</button>
</div>
</form>
</div>
</div>
@endif

<div class="card">
<div class="card-header bg-dark text-white">All Books</div>
<div class="card-body p-0">
<table class="table table-striped mb-0">
<thead class="table-dark">
<tr>
<th>#</th>
<th>Title</th>
<th>Description</th>
<th>Release Date</th>
<th>Rating</th>
<th>Created</th>
@if(auth()->user()->role=='admin')
<th>Actions</th>
@endif
</tr>
</thead>
<tbody>
@foreach($books as $i=>$b)
<tr>
<td>{{ $i+1 }}</td>
<td>{{ $b->title }}</td>
<td>{{ $b->description }}</td>
<td>{{ $b->release_date }}</td>
<td><span class="badge bg-warning">{{ $b->rating }}</span></td>
<td>{{ $b->created_at->format('M d, Y') }}</td>
@if(auth()->user()->role=='admin')
<td>
<form method="post" action="/book/{{ $b->id }}" class="d-inline">
@csrf
<input type="hidden" name="title" value="{{ $b->title }}">
<input type="hidden" name="description" value="{{ $b->description }}">
<input type="hidden" name="release_date" value="{{ $b->release_date }}">
<input type="hidden" name="rating" value="{{ $b->rating }}">
<button class="btn btn-warning btn-sm">Edit</button>
</form>
<a href="/book/delete/{{ $b->id }}" class="btn btn-danger btn-sm">Delete</a>
</td>
@endif
</tr>
@endforeach
</tbody>
</table>
</div>
</div>

@endsection
